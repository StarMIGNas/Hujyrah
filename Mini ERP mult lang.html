<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–∏–Ω–∏-ERP</title>

  <!-- PWA: manifest –∏ –∏–∫–æ–Ω–∫–∏ –≤—Å—Ç—Ä–æ–µ–Ω—ã -->
  <link rel="manifest" href="#manifest" />
  <link rel="icon" type="image/png" href="image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGNSURBVHhe7dRRCoAgEAXAVmzFdmzDZmzCJixCkQo/g4OvGd7gDTPDMwAAAMB/6t5z1X33vfcIAAAA+I9699x1333vvQMAAAD8R9177rrv/vfeAQAAAP6j7j133Xf/e+8AAAAA/1H3nrvuu/+9dwAAAAD/Ufeeu+67/713AAAAgP+oe89d993/3jsAAADAf9S956777n/vHQAAAOA/6t5z1333v/cOAAAA8B9177nrvvvfewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x13fveewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x13fveewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x1nXvfe+cDAAAAAAAAAAAAAAAAAAAAAAAD8l38LCd0F+6ZDf20AAAAASUVORK5CYII="/>
  <meta name="theme-color" content="#3498db" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="–ú–∏–Ω–∏-ERP" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      color: #333;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    h2 {
      margin-bottom: 10px;
      color: #34495e;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
      margin-right: 5px;
    }

    button:hover {
      background-color: #2980b9;
    }

    .btn-edit {
      background-color: #f39c12;
      padding: 5px 10px;
      font-size: 14px;
    }

    .btn-edit:hover {
      background-color: #d68910;
    }

    .btn-delete {
      background-color: #e74c3c;
      padding: 5px 10px;
      font-size: 14px;
    }

    .btn-delete:hover {
      background-color: #c0392b;
    }

    .btn-save {
      background-color: #27ae60;
      padding: 5px 10px;
      font-size: 14px;
    }

    .btn-save:hover {
      background-color: #219955;
    }

    .btn-cancel {
      background-color: #95a5a6;
      padding: 5px 10px;
      font-size: 14px;
    }

    .btn-cancel:hover {
      background-color: #7f8c8d;
    }

    .btn-export, .btn-import {
      background-color: #27ae60;
      margin-bottom: 15px;
    }

    .btn-export:hover, .btn-import:hover {
      background-color: #219955;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f8f9fa;
      color: #2c3e50;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    .total-row {
      font-weight: bold;
      background-color: #e8f4fc;
    }

    .reminder {
      background-color: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
      font-size: 14px;
      text-align: center;
    }

    .lang-selector {
      text-align: center;
      margin-bottom: 15px;
    }

    .lang-selector button {
      font-size: 18px;
      padding: 8px 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –í—ã–±–æ—Ä —è–∑—ã–∫–∞ -->
    <div class="card">
      <div class="lang-selector">
        <button onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button onclick="setLang('en')">üá¨üáß English</button>
        <button onclick="setLang('ar')">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
      </div>
    </div>
    <h1 id="title">Nassers soft  </h1>
    <h1 id="title">üì¶ –ú–∏–Ω–∏-ERP: –£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤ </h1>

    <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± —ç–∫—Å–ø–æ—Ä—Ç–µ -->
    <div class="card">
      <div class="reminder">
        <span id="reminder-text">üîî –ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–∫—Å–ø–æ—Ä—Ç: <span id="lastExport">–Ω–∏–∫–æ–≥–¥–∞</span>.<br>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é!</span>
      </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="card">
      <h2 id="add-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
      <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required />
      <input type="number" id="count" placeholder="–ü—Ä–∏—Ö–æ–¥ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)" min="0" required />
      <input type="number" id="price" placeholder="–¶–µ–Ω–∞" min="0" step="0.01" required />
      <button onclick="addProduct()" id="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="card">
      <h2 id="table-title">üìã –¢–æ–≤–∞—Ä—ã –Ω–∞ —Å–∫–ª–∞–¥–µ</h2>

      <!-- –ü–æ–∏—Å–∫ -->
      <div style="margin-bottom: 15px;">
        <input 
          type="text" 
          id="searchInput" 
          placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." 
          style="width: 70%; padding: 10px; font-size: 16px;"
        />
        <button onclick="findAndScrollToProduct()" style="width: 28%;" id="find-btn">–ù–∞–π—Ç–∏</button>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ -->
      <button onclick="exportData()" class="btn-export" id="export-btn">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
      <button onclick="importData()" class="btn-import" id="import-btn">üì• –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>

      <!-- –¢–∞–±–ª–∏—Ü–∞ -->
      <table id="productTable">
        <thead>
          <tr>
            <th id="op-col">–ù–∞–∑–≤–∞–Ω–∏–µ / –û–ø–µ—Ä–∞—Ü–∏—è</th>
            <th id="qty-col">–ö–æ–ª-–≤–æ</th>
            <th id="price-col">–¶–µ–Ω–∞ (‚ÇΩ)</th>
            <th id="value-col">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
            <th id="action-col">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- PWA: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π manifest -->
  <script type="application/manifest+json" id="manifest">
    {
      "name": "–ú–∏–Ω–∏-ERP",
      "short_name": "ERP",
      "description": "–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#f4f6f9",
      "theme_color": "#3498db",
      "icons": [
        {
          "src": "image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGNSURBVHhe7dRRCoAgEAXAVmzFdmzDZmzCJixCkQo/g4OvGd7gDTPDMwAAAMB/6t5z1X33vfcIAAAA+I9699x1333vvQMAAAD8R9177rrv/vfeAQAAAP6j7j133Xf/e+8AAAAA/1H3nrvuu/+9dwAAAAD/Ufeeu+67/713AAAAgP+oe89d993/3jsAAADAf9S956777n/vHQAAAOA/6t5z1333v/cOAAAA8B9177nrvvvfewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x13fveewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x13fveewcAAAD4j7r33HXd+957BwAAAPiPuvfcdZ3733sHAAAA+I+699x1nXvfe+cDAAAAAAAAAAAAAAAAAAAAAAAD8l38LCd0F+6ZDf20AAAAASUVORK5CYII",
          "sizes": "192x192",
          "type": "image/png"
        },
        {
          "src": "image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAChDSURBVHhe7Z15kBTVmcc7u7O7szuz67O7szM767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M767M......",
          "sizes": "512x512",
          "type": "image/png"
        }
      ]
    }
  </script>

  <script>
    // –Ø–∑—ã–∫–∏
    const lang = {
      ru: {
        title: "üì¶ –ú–∏–Ω–∏-ERP: –£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤",
        reminder: "üîî –ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–∫—Å–ø–æ—Ä—Ç: <span id='lastExport'>–Ω–∏–∫–æ–≥–¥–∞</span>.<br>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é!",
        addTitle: "‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä",
        addBtn: "–î–æ–±–∞–≤–∏—Ç—å",
        tableTitle: "üìã –¢–æ–≤–∞—Ä—ã –Ω–∞ —Å–∫–ª–∞–¥–µ",
        searchPlaceholder: "üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞...",
        findBtn: "–ù–∞–π—Ç–∏",
        exportBtn: "üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON",
        importBtn: "üì• –ò–º–ø–æ—Ä—Ç –∏–∑ JSON",
        opCol: "–ù–∞–∑–≤–∞–Ω–∏–µ / –û–ø–µ—Ä–∞—Ü–∏—è",
        qtyCol: "–ö–æ–ª-–≤–æ",
        priceCol: "–¶–µ–Ω–∞ (‚ÇΩ)",
        valueCol: "–°—Ç–æ–∏–º–æ—Å—Ç—å",
        actionCol: "–î–µ–π—Å—Ç–≤–∏—è",
        edit: "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
        save: "‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
        cancel: "‚ùå –û—Ç–º–µ–Ω–∞",
        delete: "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å",
        income: "(–ü—Ä–∏—Ö–æ–¥)",
        expense: "(–†–∞—Å—Ö–æ–¥)",
        balance: "–û—Å—Ç–∞—Ç–æ–∫",
        total: "–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Å—Ç–∞—Ç–∫–æ–≤:",
        noExport: "–Ω–∏–∫–æ–≥–¥–∞",
        notFound: "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω.",
        fillCorrect: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.",
        pricePositive: "–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ‚Äî –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ.",
        expenseTooHigh: "–†–∞—Å—Ö–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –ø—Ä–∏—Ö–æ–¥.",
        confirmDelete: "–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?",
        importSuccess: "‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!",
        importError: "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.",
        readError: "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞.",
        installPWA: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ú–∏–Ω–∏-ERP?",
        lang: "ru",
        dir: "ltr"
      },
      en: {
        title: "üì¶ Mini-ERP: Inventory Management",
        reminder: "üîî Last export: <span id='lastExport'>never</span>.<br>Recommended to export data once a week!",
        addTitle: "‚ûï Add Product",
        addBtn: "Add",
        tableTitle: "üìã Products in Stock",
        searchPlaceholder: "üîç Search product...",
        findBtn: "Find",
        exportBtn: "üì§ Export to JSON",
        importBtn: "üì• Import from JSON",
        opCol: "Name / Operation",
        qtyCol: "Qty",
        priceCol: "Price (‚ÇΩ)",
        valueCol: "Value",
        actionCol: "Actions",
        edit: "‚úèÔ∏è Edit",
        save: "‚úÖ Save",
        cancel: "‚ùå Cancel",
        delete: "üóëÔ∏è Delete",
        income: "(Income)",
        expense: "(Expense)",
        balance: "Balance",
        total: "Total inventory value:",
        noExport: "never",
        notFound: "Product not found.",
        fillCorrect: "Please fill all fields correctly.",
        pricePositive: "Price must be > 0, quantity ‚â• 0.",
        expenseTooHigh: "Expense cannot exceed income.",
        confirmDelete: "Delete product?",
        importSuccess: "‚úÖ Data imported successfully!",
        importError: "‚ùå Invalid file format.",
        readError: "‚ùå Error reading file.",
        installPWA: "Install Mini-ERP?",
        lang: "en",
        dir: "ltr"
      },
      ar: {
        title: "üì¶ ŸÖŸäŸÜŸä-ERP: ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ",
        reminder: "üîî ÿ¢ÿÆÿ± ÿ™ÿµÿØŸäÿ±: <span id='lastExport'>ÿ£ÿ®ÿØŸãÿß</span>.<br>ŸäŸèŸàÿµŸâ ÿ®ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸä ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ!",
        addTitle: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨",
        addBtn: "ÿ•ÿ∂ÿßŸÅÿ©",
        tableTitle: "üìã ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸÜ",
        searchPlaceholder: "üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨...",
        findBtn: "ÿ®ÿ≠ÿ´",
        exportBtn: "üì§ ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ JSON",
        importBtn: "üì• ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸÜ JSON",
        opCol: "ÿßŸÑÿßÿ≥ŸÖ / ÿßŸÑÿπŸÖŸÑŸäÿ©",
        qtyCol: "ÿßŸÑŸÉŸÖŸäÿ©",
        priceCol: "ÿßŸÑÿ≥ÿπÿ± (‚ÇΩ)",
        valueCol: "ÿßŸÑŸÇŸäŸÖÿ©",
        actionCol: "ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™",
        edit: "‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ",
        save: "‚úÖ ÿ≠ŸÅÿ∏",
        cancel: "‚ùå ÿ•ŸÑÿ∫ÿßÿ°",
        delete: "üóëÔ∏è ÿ≠ÿ∞ŸÅ",
        income: "(ÿ•ÿØÿÆÿßŸÑ)",
        expense: "(ŸÖÿµÿßÿ±ŸäŸÅ)",
        balance: "ÿßŸÑÿ±ÿµŸäÿØ",
        total: "ÿ•ÿ¨ŸÖÿßŸÑŸä ŸÇŸäŸÖÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ:",
        noExport: "ÿ£ÿ®ÿØŸãÿß",
        notFound: "ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ.",
        fillCorrect: "Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠.",
        pricePositive: "Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑÿ≥ÿπÿ± ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0ÿå ŸàÿßŸÑŸÉŸÖŸäÿ© ‚â• 0.",
        expenseTooHigh: "ŸÑÿß ŸäŸÖŸÉŸÜ ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑÿ•ÿØÿÆÿßŸÑ.",
        confirmDelete: "ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü",
        importSuccess: "‚úÖ ÿ™ŸÖ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!",
        importError: "‚ùå ÿ™ŸÜÿ≥ŸäŸÇ ŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠.",
        readError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ.",
        installPWA: "ÿ™ÿ´ÿ®Ÿäÿ™ ŸÖŸäŸÜŸä-ERPÿü",
        lang: "ar",
        dir: "rtl"
      }
    };

    let currentLang = localStorage.getItem("erp_lang") || "ru";
    document.documentElement.lang = lang[currentLang].lang;
    document.documentElement.dir = lang[currentLang].dir;

    function setLang(l) {
      currentLang = l;
      localStorage.setItem("erp_lang", l);
      document.documentElement.lang = l;
      document.documentElement.dir = lang[l].dir;
      translateUI();
      renderTable(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
    }

    function translateUI() {
      const t = lang[currentLang];
      document.getElementById("title").textContent = t.title;
      document.getElementById("reminder-text").innerHTML = t.reminder;
      document.getElementById("add-title").textContent = t.addTitle;
      document.getElementById("add-btn").textContent = t.addBtn;
      document.getElementById("table-title").textContent = t.tableTitle;
      document.getElementById("searchInput").placeholder = t.searchPlaceholder;
      document.getElementById("find-btn").textContent = t.findBtn;
      document.getElementById("export-btn").textContent = t.exportBtn;
      document.getElementById("import-btn").textContent = t.importBtn;
      document.getElementById("op-col").textContent = t.opCol;
      document.getElementById("qty-col").textContent = t.qtyCol;
      document.getElementById("price-col").textContent = t.priceCol;
      document.getElementById("value-col").textContent = t.valueCol;
      document.getElementById("action-col").textContent = t.actionCol;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    let products = [];

    function loadData() {
      const saved = localStorage.getItem("erp_products");
      if (saved) {
        products = JSON.parse(saved);
      } else {
        products = [
          { id: 1, name: currentLang === "ar" ? "ÿ¢ŸÑÿ© ÿßŸÑŸÇŸáŸàÿ©" : currentLang === "en" ? "Coffee Machine" : "–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞", income: 10, expense: 5, balance: 5, price: 12000 },
          { id: 2, name: currentLang === "ar" ? "ÿ∫ŸÑÿßŸäÿ©" : currentLang === "en" ? "Kettle" : "–ß–∞–π–Ω–∏–∫", income: 20, expense: 8, balance: 12, price: 1500 }
        ];
        saveData();
      }
      loadLastExportTime();
      translateUI();
      renderTable();
    }

    function saveData() {
      localStorage.setItem("erp_products", JSON.stringify(products));
    }

    function loadLastExportTime() {
      const time = localStorage.getItem("erp_last_export") || "–Ω–∏–∫–æ–≥–¥–∞";
      const key = currentLang === "en" ? "never" : currentLang === "ar" ? "ÿ£ÿ®ÿØŸãÿß" : "–Ω–∏–∫–æ–≥–¥–∞";
      document.getElementById("lastExport").textContent = time === "–Ω–∏–∫–æ–≥–¥–∞" ? key : new Date(parseInt(time)).toLocaleString();
    }

    function updateLastExportTime() {
      const now = Date.now();
      localStorage.setItem("erp_last_export", now);
      const key = currentLang === "en" ? "never" : currentLang === "ar" ? "ÿ£ÿ®ÿØŸãÿß" : "–Ω–∏–∫–æ–≥–¥–∞";
      document.getElementById("lastExport").textContent = new Date(now).toLocaleString();
    }

    function renderTable() {
      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";

      const sortedProducts = [...products].sort((a, b) => a.name.localeCompare(b.name));
      const t = lang[currentLang];

      let totalValue = 0;

      sortedProducts.forEach(product => {
        const value = product.balance * product.price;
        totalValue += value;

        const rowIn = document.createElement("tr");
        rowIn.innerHTML = `
          <td><strong>${product.name}</strong> <span style="color:#16a085;">${t.income}</span></td>
          <td>${product.income}</td>
          <td>${product.price.toLocaleString()} ‚ÇΩ</td>
          <td>${(product.income * product.price).toLocaleString()} ‚ÇΩ</td>
          <td><button class="btn-edit" onclick="startEdit(${product.id})">${t.edit}</button></td>
        `;
        tbody.appendChild(rowIn);

        const rowOut = document.createElement("tr");
        rowOut.innerHTML = `
          <td><span style="color:#e74c3c;">${t.expense}</span></td>
          <td>${product.expense}</td>
          <td>${product.price.toLocaleString()} ‚ÇΩ</td>
          <td>${(product.expense * product.price).toLocaleString()} ‚ÇΩ</td>
          <td></td>
        `;
        tbody.appendChild(rowOut);

        const rowBal = document.createElement("tr");
        rowBal.classList.add("total-row");
        rowBal.innerHTML = `
          <td><span style="font-weight:bold;">${t.balance}</span></td>
          <td>${product.balance}</td>
          <td>${product.price.toLocaleString()} ‚ÇΩ</td>
          <td>${value.toLocaleString()} ‚ÇΩ</td>
          <td><button class="btn-delete" onclick="deleteProduct(${product.id})">${t.delete}</button></td>
        `;
        tbody.appendChild(rowBal);
      });

      const totalRow = document.createElement("tr");
      totalRow.classList.add("total-row");
      totalRow.innerHTML = `
        <td colspan="3">${t.total}</td>
        <td>${totalValue.toLocaleString()} ‚ÇΩ</td>
        <td></td>
      `;
      tbody.appendChild(totalRow);
    }

    function startEdit(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;

      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";

      const sortedProducts = [...products].sort((a, b) => a.name.localeCompare(b.name));
      const t = lang[currentLang];

      sortedProducts.forEach(p => {
        const editing = p.id === id;
        const value = p.balance * p.price;

        const rowIn = document.createElement("tr");
        rowIn.innerHTML = `
          <td><strong>${p.name}</strong> <span style="color:#16a085;">${t.income}</span></td>
          <td><input type="number" id="edit-income" value="${p.income}" min="0" style="width:60px;"></td>
          <td><input type="number" id="edit-price" value="${p.price}" min="0" step="0.01" style="width:80px;"></td>
          <td>${(p.income * p.price).toLocaleString()} ‚ÇΩ</td>
          <td><button class="btn-save" onclick="saveEdit(${p.id})">${t.save}</button></td>
        `;
        tbody.appendChild(rowIn);

        const rowOut = document.createElement("tr");
        rowOut.innerHTML = `
          <td><span style="color:#e74c3c;">${t.expense}</span></td>
          <td><input type="number" id="edit-expense" value="${p.expense}" min="0" style="width:60px;"></td>
          <td></td>
          <td>${(p.expense * p.price).toLocaleString()} ‚ÇΩ</td>
          <td></td>
        `;
        tbody.appendChild(rowOut);

        const rowBal = document.createElement("tr");
        rowBal.classList.add("total-row");
        rowBal.innerHTML = `
          <td><span style="font-weight:bold;">${t.balance}</span></td>
          <td>${p.balance}</td>
          <td></td>
          <td>${value.toLocaleString()} ‚ÇΩ</td>
          <td><button class="btn-cancel" onclick="cancelEdit()">${t.cancel}</button></td>
        `;
        tbody.appendChild(rowBal);
      });

      const totalValue = sortedProducts.reduce((sum, p) => sum + p.balance * p.price, 0);
      const totalRow = document.createElement("tr");
      totalRow.classList.add("total-row");
      totalRow.innerHTML = `
        <td colspan="3"><strong>${t.total}</strong></td>
        <td><strong>${totalValue.toLocaleString()} ‚ÇΩ</strong></td>
        <td></td>
      `;
      tbody.appendChild(totalRow);
    }

    function saveEdit(id) {
      const income = parseInt(document.getElementById("edit-income").value) || 0;
      const expense = parseInt(document.getElementById("edit-expense").value) || 0;
      const price = parseFloat(document.getElementById("edit-price").value) || 0;

      const t = lang[currentLang];

      if (income < 0 || expense < 0 || price <= 0) {
        alert(t.pricePositive);
        return;
      }

      if (expense > income) {
        alert(t.expenseTooHigh);
        return;
      }

      const product = products.find(p => p.id === id);
      if (product) {
        product.income = income;
        product.expense = expense;
        product.balance = income - expense;
        product.price = price;
      }

      saveData();
      renderTable();
    }

    function cancelEdit() {
      renderTable();
    }

    function deleteProduct(id) {
      if (confirm(lang[currentLang].confirmDelete)) {
        products = products.filter(p => p.id !== id);
        saveData();
        renderTable();
      }
    }

    function addProduct() {
      const name = document.getElementById("name").value.trim();
      const income = parseInt(document.getElementById("count").value) || 0;
      const price = parseFloat(document.getElementById("price").value) || 0;

      const t = lang[currentLang];

      if (!name || income < 0 || price <= 0) {
        alert(t.fillCorrect);
        return;
      }

      const expense = 0;
      const balance = income - expense;

      products.push({
        id: Date.now(),
        name,
        income,
        expense,
        balance,
        price
      });
      saveData();
      renderTable();

      document.getElementById("name").value = "";
      document.getElementById("count").value = "";
      document.getElementById("price").value = "";
    }

    function findAndScrollToProduct() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      if (!query) {
        alert(lang[currentLang].notFound);
        return;
      }

      const rows = document.querySelectorAll("#productTable tbody tr:not(.total-row)");
      let foundRow = null;

      for (let row of rows) {
        const nameCell = row.cells[0];
        if (nameCell) {
          const text = nameCell.textContent.toLowerCase();
          if (text.includes(query)) {
            foundRow = row;
            break;
          }
        }
      }

      if (foundRow) {
        const viewportHeight = window.innerHeight;
        const rowTop = foundRow.getBoundingClientRect().top + window.scrollY;
        const targetScroll = rowTop - viewportHeight / 2 + foundRow.offsetHeight / 2;

        window.scrollTo({
          top: targetScroll,
          behavior: "smooth"
        });

        foundRow.style.transition = "background-color 0.5s";
        foundRow.style.backgroundColor = "#fff3cd";
        setTimeout(() => {
          foundRow.style.backgroundColor = "";
        }, 2000);
      } else {
        alert(lang[currentLang].notFound);
      }
    }

    function exportData() {
      const dataStr = JSON.stringify(products, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `erp-backup-${new Date().toISOString().split("T")[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      updateLastExportTime();
    }

    function importData() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if (Array.isArray(imported)) {
              products = imported;
              saveData();
              renderTable();
              alert(lang[currentLang].importSuccess);
            } else {
              alert(lang[currentLang].importError);
            }
          } catch (err) {
            alert(lang[currentLang].readError);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // PWA
    const swScript = `
      self.addEventListener('install', e => self.skipWaiting());
      self.addEventListener('activate', e => e.waitUntil(clients.claim()));
      self.addEventListener('fetch', e => {
        if (e.request.mode === 'navigate') {
          e.respondWith(fetch(e.request).catch(() => caches.match('index.html')));
        }
      });
    `;
    const blob = new Blob([swScript], { type: 'application/javascript' });
    const swURL = URL.createObjectURL(blob);
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register(swURL).then(() => console.log('SW registered'));
      });
    }

    window.addEventListener('beforeunload', saveData);
    loadData();
  </script>
</body>

</html>
